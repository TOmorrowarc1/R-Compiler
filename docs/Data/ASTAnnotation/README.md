# AST 标注文档索引

## 简介

AST 标注定义了一系列编译器在 Semantic 与 IR 阶段需要的语义信息类，以及在 AST 外装载部分语义信息的结构——作用域树。这些信息将用于支持类型检查、常量求值、符号管理等 Semantic阶段功能与类型表述、类内成员获取等 IR 阶段功能。本文档集详细介绍了 AST 标注的各个组件及其相互关系。

## 1. 整体架构

AST 标注由以下几个核心组件（类）构成：

1. **TypeDef（类型定义）**：定义程序中的“类型”，包括内置类型与自定义类型，即“类是什么”。
2. **TypeKind（类型种类）**：表示不同值的类型“实例”，包括由路径导向的类，数组，引用与 `NeverType` ，即“是什么类”。
3. **ValueInfo（值信息）**：表示表达式值的类型和部分属性，例如是否可变。
4. **ConstValue（常量值）**：表示一个常量的值，包括由类型信息构造的“内存布局”与具体值。
5. **ConstInfo（常量信息）**：存储常量的类型和值信息。
6. **Symbol（符号）**：表示程序中的各种符号与对应信息，如变量、函数、类型等。
7. **Scope（作用域）**：管理符号的作用域和层次结构。
8. **TraitDef（特征定义）**：定义一个特征，包括其规范的函数定义、方法定义、常量。

类之间依赖关系见各个组件的文档。

### 2. 组件简述

#### 2.1 类型信息

- **[TypeDef.md](TypeDef.md)** - 类型定义
  - 结构体和枚举类型定义
  - 字段和变体管理
  - 特征实现支持
  - 与 TypeKind 的关系

- **[TypeKind.md](TypeKind.md)** - 类型种类
  - 各种类型种类的表示
  - 类型比较
  - 多态设计
  - 与 TypeDef 的关系

#### 2.2 常量信息

- **[ConstValue.md](ConstValue.md)** - 常量值
  - 各种类型的常量值表示
  - 多态设计
  - 深拷贝支持
  - 与 ConstInfo 的关系

- **[ConstInfo.md](ConstInfo.md)** - 常量信息
  - 常量类型和值的存储
  - 延迟求值支持
  - 类型一致性检查
  - 与 ConstValue 的关系

#### 2.3 表达式值信息

- **[ValueInfo.md](ValueInfo.md)** - 值信息
  - 表达式类型和值的存储
  - 编译时常量和运行时值支持
  - 与 ConstInfo 的区别
  - 与 TypeKind 和 ConstValue 的关系
  
#### 2.4 符号和作用域信息

- **[Symbol.md](Symbol.md)** - 符号系统
  - 各种符号类型的表示
  - 符号属性管理
  - 多态设计
  - 与 Scope 的关系

- **[Scope.md](Scope.md)** - 作用域管理
  - 层次化作用域结构
  - 符号添加和查找
  - 作用域生命周期管理
  - 与 SymbolInfo 的关系
  
#### 2.5 特征信息 
- **[TraitDef.md](TraitDef.md)** - 特征定义
  - 特征常量、方法和关联函数管理
  - 特征系统实现
  - 与 TypeDef 的关系