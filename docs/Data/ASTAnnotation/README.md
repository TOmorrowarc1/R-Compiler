# AST 标注系统文档索引

## 简介

AST 标注系统是编译器中负责语义分析的核心组件，它通过在 AST 节点上附加各种标注信息，支持类型检查、常量求值、符号管理等功能。本文档集详细介绍了 AST 标注系统的各个组件及其相互关系。

## 文档结构

### 1. 整体架构

- **[Annotation.md](Annotation.md)** - AST 标注系统整体架构概述
  - 系统设计理念
  - 核心组件介绍
  - 工作流程
  - 与编译器其他部分的关系

### 2. 核心组件

#### 2.1 常量处理系统

- **[ConstEvaluator.md](ConstEvaluator.md)** - 常量求值器
  - 常量表达式求值
  - 类型符号求值
  - 作用域管理
  - 与 AST 节点的交互

- **[ConstInfo.md](ConstInfo.md)** - 常量信息
  - 常量类型和值的存储
  - 延迟求值支持
  - 类型一致性检查
  - 与 ConstValue 的关系

- **[ConstValue.md](ConstValue.md)** - 常量值
  - 各种类型的常量值表示
  - 多态设计
  - 深拷贝支持
  - 与 ConstInfo 的关系

#### 2.2 符号和作用域系统

- **[Scope.md](Scope.md)** - 作用域管理
  - 层次化作用域结构
  - 符号添加和查找
  - 作用域生命周期管理
  - 与 SymbolInfo 的关系

- **[Symbol.md](Symbol.md)** - 符号系统
  - 各种符号类型的表示
  - 符号属性管理
  - 多态设计
  - 与 Scope 的关系

#### 2.3 类型系统

- **[TypeDef.md](TypeDef.md)** - 类型定义
  - 结构体和枚举类型定义
  - 字段和变体管理
  - 特征实现支持
  - 与 TypeKind 的关系

- **[TypeKind.md](TypeKind.md)** - 类型种类
  - 各种类型种类的表示
  - 类型比较
  - 多态设计
  - 与 TypeDef 的关系

- **[TraitDef.md](TraitDef.md)** - 特征定义
  - 特征常量、方法和关联函数管理
  - 特征系统实现
  - 与 TypeDef 的关系

#### 2.4 值信息

- **[ValueInfo.md](ValueInfo.md)** - 值信息
  - 表达式类型和值的存储
  - 编译时常量和运行时值支持
  - 与 ConstInfo 的区别
  - 与 TypeKind 和 ConstValue 的关系

## 组件关系图

```
                    +----------------+
                    |   Annotation   |
                    +----------------+
                           |
         +-----------------+-----------------+
         |                 |                 |
+--------+--------+ +------+------+ +--------+--------+
| ConstEvaluator  | |   Scope     | |   TypeDef      |
+-----------------+ +-------------+ +----------------+
         |                 |                 |
         |                 |                 |
+--------+--------+ +------+------+ +--------+--------+
|   ConstInfo    | |  SymbolInfo | |   TraitDef     |
+-----------------+ +-------------+ +----------------+
         |                 |                 |
         |                 |                 |
+--------+--------+ +------+------+ +--------+--------+
|   ConstValue   | |              | |                |
+-----------------+ |              | |                |
         |           |              | |                |
         |           |              | |                |
+--------+--------+ |              | |                |
|   TypeKind     | |              | |                |
+-----------------+ |              | |                |
         |           |              | |                |
         |           |              | |                |
+--------+--------+ |              | |                |
|   ValueInfo    | |              | |                |
+-----------------+ |              | |                |
                    |              | |                |
                    +--------------+ +----------------+
```

## 使用指南

### 1. 新手入门

如果你是第一次接触 AST 标注系统，建议按以下顺序阅读：

1. **[Annotation.md](Annotation.md)** - 了解整体架构和设计理念
2. **[Scope.md](Scope.md)** - 理解作用域管理的基本概念
3. **[Symbol.md](Symbol.md)** - 了解符号系统的设计
4. **[TypeKind.md](TypeKind.md)** - 理解类型系统的基本概念

### 2. 深入理解

如果你已经了解基本概念，想要深入理解特定组件：

- **常量处理**：阅读 [ConstEvaluator.md](ConstEvaluator.md)、[ConstInfo.md](ConstInfo.md) 和 [ConstValue.md](ConstValue.md)
- **类型系统**：阅读 [TypeDef.md](TypeDef.md)、[TypeKind.md](TypeKind.md) 和 [TraitDef.md](TraitDef.md)
- **值信息**：阅读 [ValueInfo.md](ValueInfo.md)

### 3. 开发参考

如果你需要基于 AST 标注系统进行开发：

1. 了解各个组件的 API 和使用方法
2. 参考使用示例和注意事项
3. 理解组件间的交互关系
4. 遵循设计模式和最佳实践

## 常见问题

### Q1: ConstInfo 和 ValueInfo 有什么区别？

A1: `ConstInfo` 专门用于表示编译时常量，必须有值信息；而 `ValueInfo` 可以表示编译时常量和运行时值，值信息是可选的。

### Q2: TypeDef 和 TypeKind 的关系是什么？

A2: `TypeDef` 表示类型定义（如结构体、枚举的定义），而 `TypeKind` 表示类型种类（如路径类型、数组类型等）。`TypeKindPath` 会引用 `TypeDef` 对象。

### Q3: 如何在 AST 标注系统中添加新的组件？

A3: 首先确定新组件的职责和与其他组件的关系，然后遵循现有的设计模式（如多态设计、智能指针管理等），最后更新相关文档。

## 贡献指南

如果你想要改进 AST 标注系统文档：

1. 确保理解相关组件的设计和实现
2. 保持文档风格的一致性
3. 提供清晰的使用示例
4. 更新组件关系图和索引文档
5. 遵循 Markdown 格式规范

## 版本历史

- **v1.0** - 初始版本，包含所有核心组件的文档